name: RVC Voice Conversion

on:
  workflow_dispatch:

jobs:
  rvc:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    - name: Upgrade pip and install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install "numpy<2" torch==2.2.0 torchaudio==2.2.0 \
          pyworld praat-parselmouth faiss-cpu gdown

    - name: Create models directory
      run: |
        mkdir -p models

    - name: Download model and index from Drive
      run: |
        gdown "https://drive.google.com/uc?id=1gpk10q7DdwGgwa3uwoA_23kdpUFlE74W" -O models/index.npy
        gdown "https://drive.google.com/uc?id=1RekGRj8oX5wQB5rLXWecN-XPol6FpXpT" -O models/model.pth

    - name: Run Voice Conversion
      run: |
        python infer/run_vc.py \
          --input Vocals.mp3 \
          --output output.wav \
          --index models/index.npy \
          --model models/model.pth
